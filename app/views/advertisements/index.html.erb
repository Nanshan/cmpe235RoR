<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
</head>

<body>
<script>
$(function () { 
    $('#container').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Tracking Events by Advertisement and Type'
        },
        xAxis: {
            categories: ['Impression', 'Click', 'Click-through', 'SMS', 'Map', 'Call']
        },
        yAxis: {
            title: {
                text: 'Number of events'
            }
        },
        series: [{
            name: '<%= @adverts[0].name %>',
	    data: [<%=@adverts[0].events.where(type: "ImpressionEvent").length%>, <%=@adverts[0].events.where(type: "ClickEvent").length%>, <%=@adverts[0].events.where(type: "ClickThroughEvent").length%>, <%=@adverts[0].events.where(type: "SMSEvent").length%>, <%=@adverts[0].events.where(type: "MapEvent").length%>, <%=@adverts[0].events.where(type: "CallEvent").length%>]
        }, {
            name: '<%= @adverts[1].name %>',
	    data: [<%=@adverts[1].events.where(type: "ImpressionEvent").length%>, <%=@adverts[1].events.where(type: "ClickEvent").length%>, <%=@adverts[1].events.where(type: "ClickThroughEvent").length%>, <%=@adverts[1].events.where(type: "SMSEvent").length%>, <%=@adverts[1].events.where(type: "MapEvent").length%>, <%=@adverts[1].events.where(type: "CallEvent").length%>]
        }, {
            name: '<%= @adverts[2].name %>',
	    data: [<%=@adverts[2].events.where(type: "ImpressionEvent").length%>, <%=@adverts[2].events.where(type: "ClickEvent").length%>, <%=@adverts[2].events.where(type: "ClickThroughEvent").length%>, <%=@adverts[2].events.where(type: "SMSEvent").length%>, <%=@adverts[2].events.where(type: "MapEvent").length%>, <%=@adverts[2].events.where(type: "CallEvent").length%>]
        }, {
            name: '<%= @adverts[3].name %>',
	    data: [<%=@adverts[3].events.where(type: "ImpressionEvent").length%>, <%=@adverts[3].events.where(type: "ClickEvent").length%>, <%=@adverts[3].events.where(type: "ClickThroughEvent").length%>, <%=@adverts[3].events.where(type: "SMSEvent").length%>, <%=@adverts[3].events.where(type: "MapEvent").length%>, <%=@adverts[3].events.where(type: "CallEvent").length%>]
        }, {
            name: '<%= @adverts[4].name %>',
	    data: [<%=@adverts[4].events.where(type: "ImpressionEvent").length%>, <%=@adverts[4].events.where(type: "ClickEvent").length%>, <%=@adverts[4].events.where(type: "ClickThroughEvent").length%>, <%=@adverts[4].events.where(type: "SMSEvent").length%>, <%=@adverts[4].events.where(type: "MapEvent").length%>, <%=@adverts[4].events.where(type: "CallEvent").length%>]
        }]
    });
});
</script>
<div id="container" style="width:100%; height:800px;"></div>
</body>
